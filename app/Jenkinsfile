pipeline {
    agent any
    stages {
        stage ('Build') {
            steps {
                dir("app") {
<<<<<<< HEAD
             bat 'npm install'
=======
             sh 'npm install'
>>>>>>> d0eafc7488bc63865512fc715cfaece8506aecbb
            }
                
            }
        }
        

        
        stage ('Docker-build') {
            steps {
                 dir("app") {
<<<<<<< HEAD
                 bat "docker build -t alielkhatteb/nodeserver:latest ."
               }
               dir("nginx") {
                 bat "docker build -t alielkhatteb/nginx:latest ../nginx"   
=======
                 sh "docker build -t alielkhatteb/nodeserver:latest ."
               }
               dir("nginx") {
                 sh "docker build -t alielkhatteb/nginx:latest ../nginx"   
>>>>>>> d0eafc7488bc63865512fc715cfaece8506aecbb
               }  
           }
        }

        stage("DockerPush"){
            steps {
            withCredentials([string(credentialsId: 'dockerhub', variable: 'dockerhub')]) {
<<<<<<< HEAD
                    bat "docker login -u alielkhatteb -p ${dockerhub}"
                    bat "docker push alielkhatteb/nodeserver:latest"
                    bat "docker push alielkhatteb/nginx:latest"
=======
                    sh "docker login -u alielkhatteb -p ${dockerhub}"
                    sh "docker push alielkhatteb/nodeserver:latest"
                    sh "docker push alielkhatteb/nginx:latest"
>>>>>>> d0eafc7488bc63865512fc715cfaece8506aecbb
            } 
            }
        }

        stage("docker deploy"){

                steps {
			    sshagent(['ec2-t1']) {
				    sh 'ssh -o StrictHostKeyChecking=no ec2-user@put ip here "docker-compose up -d"'
			    }
                sshagent(['ec2-t2']) {
				    sh 'ssh -o StrictHostKeyChecking=no ec2-user@put ip here "docker-compose up -d"'
			    }
			}
        }
    }
}
